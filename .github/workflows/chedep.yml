name: Check Dependencies



on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

  schedule:
    - cron: "0 9 * * *" 

jobs:
  check-dependencies:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: |
          npm install
          npm list --depth=0

      - name: Generate dependency JSON
        run: |
          npm list --json --depth=0 > deps.json || npm list --json > deps.json
          cat deps.json

      - name: Upload dependency graph
        run: |
          if [ -f deps.json ]; then
            curl -X POST "https://anchor-wine.vercel.app/api/deps" \
              -H "Content-Type: application/json" \
              --data-binary @deps.json
          else
            echo "Error: deps.json file not found"
            exit 1
          

      